<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ Ch∆°i H·ªçc To√°n</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f4f8;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
            color: #333;
        }

        .game-container {
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 10px;
            width: 100%;
            max-width: 90%; /* Adjusted max-width for better display */
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-sizing: border-box;
            position: relative; /* Needed for z-index of popup */
            z-index: 1; /* Ensure game content is below popup overlay */
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            margin-top: 0px;
            font-size: 2.2em;
        }

        .score-board {
            background-color: #e0f7fa;
            border-radius: 10px;
            margin-top: 0px;
            padding: 15px;
            font-size: 1.2em;
            color: #00796b;
            font-weight: bold;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .question-area {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            font-size: 2.5em;
            font-weight: bold;
            color: #34495e;
            min-height: 80px; /* Keep min-height for consistent layout */
            display: flex; /* Use flex to center content */
            align-items: center;
            justify-content: center;
            border: 1px solid #e0e0e0;
        }

        /* Styles for horizontal math problem display */
        .math-problem-horizontal {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1em; /* Inherit from question-area */
            font-weight: bold;
            color: #34495e;
            width: 100%; /* Take full width */
            box-sizing: border-box;
        }

        .math-problem-horizontal span {
            margin: 0 10px; /* Space between numbers and operator */
        }

        .input-area {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .answer-inputs {
            display: flex;
            gap: 5px; /* Small gap between tens and units input */
            justify-content: center;
            align-items: center;
        }

        .answer-digit-input {
            padding: 12px 10px;
            border: 2px solid #a7d9f2;
            border-radius: 8px;
            font-size: 1.5em;
            width: 120px; /* Wider width for single input */
            text-align: center;
            transition: border-color 0.3s ease;
        }

        .answer-digit-input:focus {
            outline: none;
            border-color: #007bff;
        }

        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 25px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
            font-weight: bold;
        }

        .btn:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 123, 255, 0.4);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 123, 255, 0.2);
        }

        #feedback {
            font-size: 1.3em;
            font-weight: bold;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .feedback-correct {
            color: #28a745; /* Green */
        }

        .feedback-incorrect {
            color: #dc3545; /* Red */
        }

        .road-container {
            width: 100%;
            overflow-x: auto; /* Allow horizontal scrolling if road gets very long */
            margin-top: 0px;
            background-color: #e9ecef;
            border-radius: 10px;
            padding: 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
        }

        #roadCanvas {
            background-color: #6c757d; /* Darker grey for road */
            border-radius: 8px;
            display: block;
            margin: 0 auto;
            border: 2px solid #495057;
        }

        /* Popup Styles */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Dark overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px); /* Optional: blur background */
        }

        .popup-content {
            background: linear-gradient(135deg, #FFD700, #FF6347, #9ACD32); /* Vibrant gradient */
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            padding: 40px;
            text-align: center;
            width: 80%; /* Adjusted for 50% screen, but responsive */
            max-width: 500px; /* Max width to prevent it from being too large */
            color: white;
            transform: scale(0.8);
            opacity: 0;
            animation: popupAppear 0.5s forwards cubic-bezier(0.68, -0.55, 0.27, 1.55); /* Bounce effect */
            border: 5px solid #FFEB3B; /* Gold border */
            position: relative; /* For pseudo-element animation */
            overflow: hidden; /* Hide overflow from pseudo-element */
        }

        @keyframes popupAppear {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .popup-content h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #fff; /* White text for contrast */
            text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
        }

        .popup-content p {
            font-size: 1.4em;
            margin-bottom: 10px;
            color: #f8f8f8;
        }

        .popup-content .btn {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 1.5em;
            background-color: #4CAF50; /* Green for restart */
            box-shadow: 0 6px 15px rgba(76, 175, 80, 0.4);
        }

        .popup-content .btn:hover {
            background-color: #45a049;
        }

        /* Simple celebratory effect using pseudo-element */
        .popup-content::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            animation: pulseEffect 2s infinite alternate;
            border-radius: 50%; /* Circular pulse */
            z-index: -1; /* Behind content */
        }

        @keyframes pulseEffect {
            from { transform: scale(1) rotate(0deg); opacity: 1; }
            to { transform: scale(1.1) rotate(10deg); opacity: 0.8; }
        }


        @media (max-width: 768px) {
            .game-container {
                padding: 20px;
            }
            h1 {
                font-size: 1.8em;
            }
            .score-board, .question-area {
                font-size: 1.8em;
            }
            .answer-digit-input {
                font-size: 1.2em;
                width: 80px; /* Adjusted width for single input on mobile */
            }
            .btn {
                padding: 10px 20px;
                font-size: 1em;
            }
            .input-area {
                flex-direction: column;
            }
            .popup-content {
                width: 90%;
                padding: 25px;
            }
            .popup-content h2 {
                font-size: 2em;
            }
            .popup-content p {
                font-size: 1.2em;
            }
            .popup-content .btn {
                padding: 12px 30px;
                font-size: 1.3em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Tr√≤ Ch∆°i H·ªçc To√°n</h1>

        <div class="score-board">
            <span>ƒê√∫ng: <span id="correctCount">0</span></span>
            <span>Sai: <span id="incorrectCount">0</span></span>
        </div>

        <div class="question-area" id="questionArea">
            <!-- C√¢u h·ªèi s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y theo h√†ng ngang -->
        </div>

        <div class="input-area">
            <div class="answer-inputs">
                <input type="text" id="answerInput" class="answer-digit-input" placeholder="" maxlength="2" inputmode="numeric">
            </div>
            <button class="btn" id="submitBtn">Ki·ªÉm Tra</button>
            <button class="btn" id="nextBtn" style="display: none;">C√¢u K·∫ø Ti·∫øp</button>
        </div>

        <div id="feedback">
            <!-- Ph·∫£n h·ªìi s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
        </div>

        <div class="road-container">
            <canvas id="roadCanvas"></canvas>
        </div>
    </div>

    <!-- Victory Popup -->
    <div id="victoryPopup" class="popup-overlay" style="display: none;">
        <div class="popup-content">
            <h2>Ho√†n Th√†nh Ch·∫∑ng ƒê∆∞·ªùng! üéâ</h2>
            <p id="popupMessage">B·∫°n ƒë√£ l√† nh√† v√¥ ƒë·ªãch to√°n h·ªçc!</p>
            <p>B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng: <span id="popupCorrectCount">0</span> c√¢u</p>
            <p>B·∫°n ƒë√£ tr·∫£ l·ªùi sai: <span id="popupIncorrectCount">0</span> c√¢u</p>
            <button class="btn" id="popupRestartBtn">Ch∆°i L·∫°i</button>
        </div>
    </div>

    <script>
        const questionArea = document.getElementById('questionArea');
        const answerInput = document.getElementById('answerInput'); // ƒê√£ thay ƒë·ªïi th√†nh m·ªôt √¥ nh·∫≠p li·ªáu
        const submitBtn = document.getElementById('submitBtn');
        const nextBtn = document.getElementById('nextBtn');
        const feedbackDiv = document.getElementById('feedback');
        const correctCountSpan = document.getElementById('correctCount');
        const incorrectCountSpan = document.getElementById('incorrectCount');
        const roadCanvas = document.getElementById('roadCanvas');
        const ctx = roadCanvas.getContext('2d');

        // C√°c ph·∫ßn t·ª≠ Popup
        const victoryPopup = document.getElementById('victoryPopup');
        const popupMessage = document.getElementById('popupMessage');
        const popupCorrectCount = document.getElementById('popupCorrectCount');
        const popupIncorrectCount = document.getElementById('popupIncorrectCount');
        const popupRestartBtn = document.getElementById('popupRestartBtn');

        let currentQuestion = {};
        let correctAnswers = 0;
        let incorrectAnswers = 0;
        const maxRoadLength = 30; // S·ªë c√¢u tr·∫£ l·ªùi ƒë√∫ng ƒë·ªÉ "ho√†n th√†nh" con ƒë∆∞·ªùng
        const markerInterval = 2; // ƒê·∫∑t m·ªôt ƒëi·ªÉm ƒë√°nh d·∫•u sau m·ªói X c√¢u tr·∫£ l·ªùi ƒë√∫ng

        // H√†m t·∫°o s·ªë ng·∫´u nhi√™n trong m·ªôt ph·∫°m vi
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // H√†m t·∫°o ph√©p nh√¢n trong b·∫£ng c·ª≠u ch∆∞∆°ng 5
        function generateMultiplicationProblem() {
            const num1 = 9; // Lu√¥n l√† s·ªë 5
            // const num1 = getRandomInt(1, 2); // S·ªë th·ª© hai t·ª´ 1 ƒë·∫øn 10
            const num2 = getRandomInt(1, 10); // S·ªë th·ª© hai t·ª´ 1 ƒë·∫øn 10
            const product = num1 * num2;

            return {
                question: `${num1} x ${num2} = ?`,
                num1: num1,
                num2: num2,
                operator: 'x',
                answer: product
            };
        }

        // H√†m t·∫°o c√¢u h·ªèi m·ªõi
        function generateNewQuestion() {
            currentQuestion = generateMultiplicationProblem();

            // Hi·ªÉn th·ªã c√¢u h·ªèi theo ƒë·ªãnh d·∫°ng h√†ng ngang
            questionArea.innerHTML = `
                <div class="math-problem-horizontal">
                    <span>${currentQuestion.num1}</span>
                    <span>${currentQuestion.operator}</span>
                    <span>${currentQuestion.num2}</span>
                    <span>= ?</span>
                </div>
            `;

            answerInput.value = ''; // X√≥a gi√° tr·ªã c·ªßa √¥ nh·∫≠p li·ªáu duy nh·∫•t
            feedbackDiv.textContent = '';
            feedbackDiv.className = ''; // X√≥a ki·ªÉu ph·∫£n h·ªìi
            submitBtn.style.display = 'inline-block';
            nextBtn.style.display = 'none';
            answerInput.disabled = false; // B·∫≠t input
            answerInput.focus(); // T·∫≠p trung v√†o input khi b·∫Øt ƒë·∫ßu c√¢u h·ªèi m·ªõi
        }

        // H√†m v·∫Ω con ƒë∆∞·ªùng
        function drawRoad() {
            const roadWidth = Math.max(roadCanvas.parentElement.clientWidth, correctAnswers * (roadCanvas.parentElement.clientWidth / maxRoadLength) + 300); // Con ƒë∆∞·ªùng m·ªü r·ªông khi ti·∫øn ƒë·ªô tƒÉng
            roadCanvas.width = roadWidth; // ƒêi·ªÅu ch·ªânh chi·ªÅu r·ªông canvas ƒë·ªông
            roadCanvas.height = 80; // Chi·ªÅu cao c·ªë ƒë·ªãnh cho con ƒë∆∞·ªùng

            ctx.clearRect(0, 0, roadCanvas.width, roadCanvas.height);

            // V·∫Ω n·ªÅn ƒë∆∞·ªùng
            ctx.fillStyle = '#6c757d'; // X√°m ƒë·∫≠m
            ctx.fillRect(0, 0, roadCanvas.width, roadCanvas.height);

            // V·∫Ω v·∫°ch ƒë∆∞·ªùng
            ctx.strokeStyle = '#f8f9fa'; // X√°m nh·∫°t/tr·∫Øng cho v·∫°ch
            ctx.lineWidth = 4;
            const lineDash = [20, 20]; // ƒê·ªô d√†i v·∫°ch, ƒë·ªô d√†i kho·∫£ng tr·ªëng
            const lineY = roadCanvas.height / 2;

            for (let i = 0; i < roadCanvas.width; i += lineDash[0] + lineDash[1]) {
                ctx.beginPath();
                ctx.moveTo(i, lineY);
                ctx.lineTo(i + lineDash[0], lineY);
                ctx.stroke();
            }

            // V·∫Ω c√°c ƒëi·ªÉm ƒë√°nh d·∫•u d·ª±a tr√™n s·ªë c√¢u tr·∫£ l·ªùi ƒë√∫ng
            ctx.fillStyle = '#ffc107'; // V√†ng cho ƒëi·ªÉm ƒë√°nh d·∫•u
            ctx.strokeStyle = '#dc3545'; // Vi·ªÅn ƒë·ªè cho ƒëi·ªÉm ƒë√°nh d·∫•u
            ctx.lineWidth = 2;

            for (let i = 0; i <= correctAnswers; i += markerInterval) {
                if (i === 0 && correctAnswers === 0) { // Lu√¥n hi·ªÉn th·ªã ƒëi·ªÉm b·∫Øt ƒë·∫ßu
                    drawMarker(20, 'B·∫Øt ƒë·∫ßu'); // ƒêi·ªÉm b·∫Øt ƒë·∫ßu h∆°i l·ªách
                } else if (i > 0) {
                    const markerX = (i / maxRoadLength) * roadCanvas.width;
                    drawMarker(markerX, `${i} ƒëi·ªÉm`);
                }
            }

            // V·∫Ω ƒëi·ªÉm ƒë√°nh d·∫•u ti·∫øn ƒë·ªô hi·ªán t·∫°i (xe/ng∆∞·ªùi ch∆°i)
            const playerX = (correctAnswers / maxRoadLength) * roadCanvas.width;
            drawPlayer(playerX);
        }

        // H√†m v·∫Ω m·ªôt ƒëi·ªÉm ƒë√°nh d·∫•u ng√¥i sao
        function drawMarker(x, text) {
            const markerSize = 25; // Ng√¥i sao l·ªõn h∆°n
            const numPoints = 5;
            const outerRadius = markerSize / 2;
            const innerRadius = outerRadius / 2.5; // L√†m b√°n k√≠nh b√™n trong nh·ªè h∆°n ƒë·ªÉ c√°c ƒëi·ªÉm s·∫Øc n√©t h∆°n

            ctx.save(); // L∆∞u tr·∫°ng th√°i canvas hi·ªán t·∫°i
            ctx.translate(x, roadCanvas.height / 2); // Di chuy·ªÉn g·ªëc ƒë·∫øn t√¢m ƒëi·ªÉm ƒë√°nh d·∫•u
            ctx.rotate(Math.PI / 10); // Xoay nh·∫π ƒë·ªÉ m·ªôt ƒëi·ªÉm h∆∞·ªõng l√™n

            ctx.beginPath();
            for (let i = 0; i < numPoints; i++) {
                ctx.lineTo(Math.cos(i * 2 * Math.PI / numPoints) * outerRadius,
                           Math.sin(i * 2 * Math.PI / numPoints) * outerRadius);
                ctx.lineTo(Math.cos((i * 2 + 1) * Math.PI / numPoints) * innerRadius,
                           Math.sin((i * 2 + 1) * Math.PI / numPoints) * innerRadius);
            }
            ctx.closePath();

            ctx.fillStyle = '#FFD700'; // M√†u v√†ng kim cho ng√¥i sao
            ctx.strokeStyle = '#DAA520'; // Vi·ªÅn v√†ng ƒë·∫≠m h∆°n
            ctx.lineWidth = 2;
            ctx.shadowColor = 'rgba(255, 215, 0, 0.5)'; // √Ånh s√°ng v√†ng
            ctx.shadowBlur = 10;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;

            ctx.fill();
            ctx.stroke();

            ctx.restore(); // Kh√¥i ph·ª•c tr·∫°ng th√°i canvas

            ctx.fillStyle = '#212529'; // Ch·ªØ m√†u t·ªëi
            ctx.font = '14px Inter'; // Ph√¥ng ch·ªØ l·ªõn h∆°n m·ªôt ch√∫t cho vƒÉn b·∫£n
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(text, x, roadCanvas.height / 2 + markerSize + 5);
        }

        // H√†m v·∫Ω bi·ªÉu t∆∞·ª£ng xe d·ªÖ th∆∞∆°ng
        function drawPlayer(x) {
            const playerWidth = 40;
            const playerHeight = 30;
            const playerY = roadCanvas.height / 2 - playerHeight - 5; // V·ªã tr√≠ ph√≠a tr√™n v·∫°ch ƒë∆∞·ªùng, h∆°i cao h∆°n

            ctx.fillStyle = '#FF6347'; // M√†u ƒë·ªè c√† chua cho chi·∫øc xe vui nh·ªôn
            ctx.strokeStyle = '#CD5C5C'; // Vi·ªÅn m√†u ƒë·ªè ·∫§n ƒê·ªô
            ctx.lineWidth = 2;

            // Th√¢n xe (h√¨nh ch·ªØ nh·∫≠t bo tr√≤n)
            ctx.beginPath();
            ctx.roundRect(x - playerWidth / 2, playerY, playerWidth, playerHeight, 8); // Bo tr√≤n nhi·ªÅu h∆°n
            ctx.fill();
            ctx.stroke();

            // Cabin (h√¨nh ch·ªØ nh·∫≠t bo tr√≤n nh·ªè h∆°n ·ªü tr√™n)
            ctx.fillStyle = '#ADD8E6'; // M√†u xanh nh·∫°t cho c·ª≠a s·ªï
            ctx.strokeStyle = '#6A5ACD'; // Vi·ªÅn m√†u xanh ƒë√°
            ctx.beginPath();
            ctx.roundRect(x - playerWidth * 0.3, playerY - playerHeight * 0.4, playerWidth * 0.6, playerHeight * 0.6, 5);
            ctx.fill();
            ctx.stroke();

            // B√°nh xe
            ctx.fillStyle = '#343a40'; // X√°m ƒë·∫≠m cho b√°nh xe
            ctx.strokeStyle = '#212529';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(x - playerWidth * 0.3, playerY + playerHeight - 5, playerWidth * 0.15, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(x + playerWidth * 0.3, playerY + playerHeight - 5, playerWidth * 0.15, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();

            // ƒê√®n pha (h√¨nh tr√≤n nh·ªè m√†u v√†ng)
            ctx.fillStyle = '#FFD700'; // V√†ng kim cho ƒë√®n pha
            ctx.beginPath();
            ctx.arc(x - playerWidth * 0.4, playerY + playerHeight * 0.7, 3, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(x + playerWidth * 0.4, playerY + playerHeight * 0.7, 3, 0, Math.PI * 2);
            ctx.fill();
        }

        // Tr√¨nh x·ª≠ l√Ω s·ª± ki·ªán cho n√∫t ki·ªÉm tra
        submitBtn.addEventListener('click', () => {
            checkAnswer();
        });

        // Tr√¨nh x·ª≠ l√Ω s·ª± ki·ªán cho ph√≠m Enter tr√™n tr∆∞·ªùng nh·∫≠p li·ªáu
        answerInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                if (submitBtn.style.display !== 'none') {
                    checkAnswer();
                } else if (nextBtn.style.display !== 'none') {
                    generateNewQuestion();
                }
            }
        });

        // Logic t·ª± ƒë·ªông focus cho tr∆∞·ªùng nh·∫≠p li·ªáu
        answerInput.addEventListener('input', (e) => {
            // Gi·ªõi h·∫°n input 2 ch·ªØ s·ªë v√† ƒë·∫£m b·∫£o ƒë√≥ l√† s·ªë
            e.target.value = e.target.value.replace(/[^0-9]/g, '').slice(0, 2);
        });

        // Tr√¨nh x·ª≠ l√Ω s·ª± ki·ªán cho n√∫t ti·∫øp theo
        nextBtn.addEventListener('click', () => {
            generateNewQuestion();
            drawRoad(); // V·∫Ω l·∫°i con ƒë∆∞·ªùng sau c√¢u h·ªèi m·ªõi
        });

        // Tr√¨nh x·ª≠ l√Ω s·ª± ki·ªán cho n√∫t kh·ªüi ƒë·ªông l·∫°i popup
        popupRestartBtn.addEventListener('click', () => {
            resetGame();
        });

        // H√†m ki·ªÉm tra c√¢u tr·∫£ l·ªùi
        function checkAnswer() {
            const userAnswer = parseInt(answerInput.value);

            if (isNaN(userAnswer)) {
                feedbackDiv.textContent = '·ªê ·ªì, b·∫°n ch∆∞a nh·∫≠p s·ªë n√†o k√¨a! üßê';
                feedbackDiv.className = 'feedback-incorrect';
                return;
            }

            if (userAnswer === currentQuestion.answer) {
                feedbackDiv.textContent = 'Si√™u sao! Ch√≠nh x√°c r·ªìi! ‚ú®';
                feedbackDiv.className = 'feedback-correct';
                correctAnswers++;
            } else {
                feedbackDiv.textContent = `Ti·∫øc qu√°, ch∆∞a ƒë√∫ng r·ªìi. C√¢u tr·∫£ l·ªùi ƒë√∫ng l√† ${currentQuestion.answer}. C·ªë g·∫Øng l√™n nh√©! üòÖ`;
                feedbackDiv.className = 'feedback-incorrect';
                incorrectAnswers++;
            }

            correctCountSpan.textContent = correctAnswers;
            incorrectCountSpan.textContent = incorrectAnswers;

            submitBtn.style.display = 'none';
            answerInput.disabled = true; // V√¥ hi·ªáu h√≥a input sau khi tr·∫£ l·ªùi

            if (correctAnswers >= maxRoadLength) {
                // Hi·ªÉn th·ªã popup chi·∫øn th·∫Øng
                popupMessage.textContent = `B·∫°n ƒë√£ l√† nh√† v√¥ ƒë·ªãch to√°n h·ªçc!`;
                popupCorrectCount.textContent = correctAnswers;
                popupIncorrectCount.textContent = incorrectAnswers;
                victoryPopup.style.display = 'flex'; // Hi·ªÉn th·ªã popup

                // ·∫®n c√°c ƒëi·ªÅu khi·ªÉn tr√≤ ch∆°i ch√≠nh
                submitBtn.style.display = 'none';
                nextBtn.style.display = 'none';
                questionArea.innerHTML = ''; // X√≥a c√¢u h·ªèi
                answerInput.value = ''; // X√≥a input
                feedbackDiv.textContent = ''; // X√≥a ph·∫£n h·ªìi
            } else {
                nextBtn.style.display = 'inline-block';
            }
            drawRoad(); // C·∫≠p nh·∫≠t hi·ªÉn th·ªã con ƒë∆∞·ªùng
        }

        // H√†m ƒë·∫∑t l·∫°i tr√≤ ch∆°i
        function resetGame() {
            correctAnswers = 0;
            incorrectAnswers = 0;
            correctCountSpan.textContent = correctAnswers;
            incorrectCountSpan.textContent = incorrectAnswers;
            victoryPopup.style.display = 'none'; // ·∫®n popup
            generateNewQuestion();
            drawRoad();
        }

        // Kh·ªüi t·∫°o tr√≤ ch∆°i
        window.onload = function() {
            generateNewQuestion();
            drawRoad(); // V·∫Ω con ƒë∆∞·ªùng ban ƒë·∫ßu
            // ƒêi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc canvas ƒë·ªÉ ƒë√°p ·ª©ng
            const resizeCanvas = () => {
                const containerWidth = roadCanvas.parentElement.clientWidth;
                roadCanvas.width = containerWidth;
                drawRoad();
            };
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas(); // G·ªçi ban ƒë·∫ßu ƒë·ªÉ ƒë·∫∑t k√≠ch th∆∞·ªõc
        };
    </script>
</body>
</html>
